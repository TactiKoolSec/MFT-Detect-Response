title: {ProductName} Command Post Exploitation PowerShell Commands
id: {GUID}
status: experimental
description: Detects common post-exploitation executions of powershell.exe spawned from {ProductName} {WebAppProcess} web hosting process. 
references:
author: X-Force Proactive Threat Detection Platform
date: {DATE}
tags:
    - attack.discovery
logsource:
    category: process_creation
    product: windows
detection:
    selection:
        ParentImage:
            - '*\{WebAppProcess}'	
        Image:
            - '*\powershell.exe'
    cmdline:
        CommandLine:
            - '* -nop*'
            - '* -noni*'
            - '* -w hidden *'
            - '* -windowstyle hidden*'
            - '*(New-Object Net.WebClient).Download*'
            - '* -enc *'
            - '* -EncodedCommand *'
    condition: selection and cmdline
fields:
    - ComputerName
    - User
    - CommandLine
    - ParentCommandLine
falsepositives:
    - Will need to be tuned. 
level: low