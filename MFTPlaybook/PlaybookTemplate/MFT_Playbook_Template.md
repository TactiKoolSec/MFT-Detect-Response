MFT Incident Response Playbook Template

# Usage

This playbook template is not meant for production use. It is intended to
provider responders with a template acting as a starting point for the
development of a playbook and should not be used within a professional
environment without customization and testing to ensure it meets the requisite
standards and policies.

# Purpose

This comprehensive playbook serves as a resource for incident response teams,
allowing them to address security incidents concerning compromised {ProductName}
Managed File Transfer software. It offers guidance to identify essential sources
of vital information. By adhering to the playbook's guidelines, teams can
confidently take decisive actions to contain threats and efficiently restore the
managed file transfer service to a fortified and secure state.

This document contains the following sections:

-   Prerequisites: Requirements that must be fulfilled before beginning the
    investigation.

-   Identification: Documentation of the process to follow in the event an
    incident is identified. This process will cover notification and
    communication standards.

-   Workflow: The sequence of logical steps that should be followed to conduct
    the investigation.

-   Assessment: Guidance to help drive the investigation to gather and analyze
    relevant data sources to uncover evidence associated with the incident.

-   Containment: Provides guidance to contain potential damage related to the
    incident and preventing further harm.

-   Eradication:

-   Lessons Learned: Discover and document the root cause and evaluate the
    effectiveness of the response

# Prerequisites

The following steps should be completed prior to an event or incident

-   Requisite Data Access: Develop capabilities to obtain and preserve incident
    response data such as forensic images, forensic metadata collections, and
    log data from various sources such as EDR, AV, SIEM, and firewall solutions.

-   Familiarity with Log Analysis Tools: Prior experience and familiarity with
    various Log Analysis Tools are essential. These tools assist in parsing and
    interpreting log data from multiple sources, providing a broader perspective
    on system events and potential security incidents.

-   Determine members and roles of the cybersecurity incident response team
    (CSIRT).

    -   The roles and responsibilities of the CSIRT team should be
        well-documented and established

-   Identify and document stakeholders and system owners

    -   The CSIRT team should be immediately able to contact the relevant system
        owners and stakeholders to answer relevant question regarding recent
        changes or activities on the affected system.

-   Define escalation paths

    -   CSIRT team should have a well-defined process for incidents to evolve
        from a low to high priority as more information is gathered regarding
        the incident.

    -   Escalation paths should include customized documentation and
        communication standards.

# Workflow

![A screenshot of a computer Description automatically
generated](media/f97f964a5695fe70edd672d309279ec0.png)

# Identification

| ID    | Step                                     | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Responsible  |
|-------|------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|
| 1.1   | Report an Incident                       | Report any suspicious activity to the Service Desk. Next step 1.2                                                                                                                                                                                                                                                                                                                                                                                              | User         |
| 1.2   | Create an Incident Ticket                | Create an incident ticket for the incident.  The following information must be included in the ticket: Date and time when the incident happened Name and the user ID of the user who was involved MFT solution business purpose Infected system name, IP address and OS version If the system is identified as critical Short description what user observed and steps to identify the activity The incident ticket will be assigned to “CSIRT”. Next step 1.6 | Service Desk |
| 1.3   | Analyse Logs, Alert                      | Analyse identified events. Escalate noteworthy events to CSIRT.  Next step 1.5                                                                                                                                                                                                                                                                                                                                                                                 | SOC          |
| 1.4   | Analyse Alert Information                | Analyse identified threat or alert information.  Try to build a logical picture on which course of actions might have led to the alert. Does the information indicate any of the following: Interview user if needed Identify the criticality of the affected device Identify the criticality of the affected user Next step 1.5                                                                                                                               | CSIRT        |
| 1.5   | Create an Incident Ticket                | Create an incident ticket for the incident.  The following information must be included in the ticket: Date and time when the incident happened Name and the user ID of the user who was involved Infected system name, IP address and OS version A short description of the incident Next step 1.7                                                                                                                                                            | CSIRT        |
| 1.6   | Analyse Alert Information                | Evaluate and analyse available information: Try to build a logical picture which course of actions might have led to the alert.  Try to identify any filenames, IPs, domains, hashes associated w/ the alert Interview system owner if needed Next step 1.7                                                                                                                                                                                                    | CSIRT        |
| 1.7   | Parallel Gateway                         | Select any of the following steps: 1.7.1 – 1.7.4                                                                                                                                                                                                                                                                                                                                                                                                               | CSIRT        |
| 1.7.1 | Check Alerts from Other Security Systems | Search any other possible related alerts. Search security tooling solution for Process name Host name and IP address of infected host Username of the affected user External IP addresses, filenames, hashes, etc (if communication has been identified) etc Wait on step 1.8                                                                                                                                                                                  | CSIRT        |
| 1.7.2 | Quick Analyse of Threat data             | Perform high level analysis of the alert and check against any threat intelligence sources for verification.  Wait on step 1.8                                                                                                                                                                                                                                                                                                                                 | CSIRT        |
| 1.7.3 | Check Known False Positives              | Check if this alert is known to be a false positive.  Wait on step 1.8                                                                                                                                                                                                                                                                                                                                                                                         | CSIRT        |
| 1.8   | Sum Gateway                              | Wait until all executed flows are ready, next step 1.9                                                                                                                                                                                                                                                                                                                                                                                                         | CSIRT        |
| 1.9   | False Positive?                          | Conclude if the incident is a false positive.  Can we conclude that the incident is NOT a Malware incident?  If “Yes”, next step End. If “No”, next step 1.10                                                                                                                                                                                                                                                                                                  | CSIRT        |
| 1.10  | Create IOC File                          | Add key collected artifacts to single description file.  Include info such as: Malicious processes names / patterns Malicious file hashes Malicious URL Malicious Server IPs Malicious Emails (subject/URL/IP).                                                                                                                                                                                                                                                | CSIRT        |

# Assessment

| ID    | Step                                                                       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Responsible |
|-------|----------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 2.1   | Parallel Gateway                                                           | Select any of the following steps: 2.1.1 – 2.1.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | CSIRT       |
| 2.1.1 | Examine processes spawned from MFT web hosting process                     | Examine process execution data sources for processes spawned by {WebAppProcess}  Suspicious child processes such as csc.exe, cmd.exe, and powershell.exe should be flagged for immediate analysis Also Consider: File extension Environment of execution (cross-platform, library needed, etc.) The obfuscated content of the suspicious file The location of the suspicious files (local files, shared folder, etc.) Last Access / Modified time of related files Potential network activity Wait on step 2.4                      | CSIRT       |
| 2.1.2 | Examine processes spawned from MFT service account                         | Examine process execution data sources for processes spawned by the user account associated with the service named {MFTServiceName}  Suspicious process executions considerations: File extension [Living off the land binaries](https://lolbas-project.github.io/) Environment of execution (cross-platform, library needed, etc.) The obfuscated content of the suspicious file The location of the suspicious files (local files, shared folder, etc.) Last Access / Modified time of related files Potential network activity   | CSIRT       |
| 2.1.3 | Analyse Host for web shells                                                | Analyse MFT web enabled directories. Analyze any unexpected files in:  {WebAppDirectory} {MFTDataBaseDirectory} Check the following: Files with extensions such as aspx, php, jsf, pl, py Files with recent creation timestamps  Files with anomalous sizes Wait on step 2.4                                                                                                                                                                                                                                                        | CSIRT       |
| 2.1.4 | Analyze MFT authentication logs and user accounts for suspicious entries.  | Examine MFT authentication logs located in:  {MFTAuthenticationLogs}  {WebAppAuthenticationEvents} MFT Admin Console  Examine MFT users lists located in:  {MFTUsers} MFT Admin Console  Check the following: Authentications from anomalous source IP addresses or time of day. Multiple failed log ins followed by a successful authentication.  Impossible travel authentications.  Newly created or modified users                                                                                                              | CSIRT       |
| 2.1.5 | Analyze MFT access and activity logs for suspicious entries                | Examine MFT activity and access logs located in: {MFTFileTransferLogs} {WebAppFileTransferLogs}  Check the following: User and file activity without a corresponding authentication event Access logs containing database commands such as “Insert Into” and “From Table” Bulk file downloads associated with single user or session File downloads activity across service areas or business units associated with single user or session                                                                                          | CSIRT       |
| 2.1.6 | Analyze MFT database activity for suspicious activity                      | Examine MFT databases located in:  {MFTDataBaseDirectory}  Check the following: Recent database backups or data dumps Recent database changes altering users, permissions, or logging configurations.                                                                                                                                                                                                                                                                                                                               | CSIRT       |
| 2.1.7 | AnalyzeMFT automation activity for suspicious activity (if supported)      | Examine MFT automation logs located in: {MFTAutomationArtifact}  Example Process Creation events spawned from {AutomationProcess}                                                                                                                                                                                                                                                                                                                                                                                                   | CSIRT       |
| 2.1.8 | Initiate Other Playbooks                                                   | Initiate playbook that could be related to the investigation. [Organizations should implement applicable IR processes or playbooks related to assessment here] Wait on step 2.5                                                                                                                                                                                                                                                                                                                                                     | CSIRT       |
| 2.2   | Sum Gateway                                                                | Wait until all executed flows are ready, next step 2.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | CSIRT       |
| 2.7   | Parallel Gateway                                                           | Select any of the following steps: 2.5.1 – 2.5.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | CSIRT       |
| 2.5.1 | Identify Other Potential Victims                                           | Identify other systems that may have been affected. Consider the following aspects Systems which are on the same subnet Systems which have communicated to same malicious destination (if any) Systems which have the same vulnerability which is used by the malware Scan the environment for possible IOC matches Wait on step 2.6                                                                                                                                                                                                | CSIRT       |
| 2.5.2 | Correlate With Other Incidents                                             | Correlate the findings with other ongoing or recent incidents Search incident tracking system for Similar incident in last 24 hour and in last 7 days Wait on step 2.6                                                                                                                                                                                                                                                                                                                                                              | CSIRT       |
| 2.5.3 | Check Threat Information                                                   | Check the threat information via OSINT or internal/third-party Threat Intelligence services. Next step 2.6                                                                                                                                                                                                                                                                                                                                                                                                                          | CSIRT       |
| 2.6   | Sum Gateway                                                                | Wait until all executed flows are ready, next step 2.7                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | CSIRT       |
| 2.7   | Parallel Gateway                                                           | Select any of the following steps: 2.7.1 or 2.7.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | CSIRT       |
| 2.7.1 | Information Assessment?                                                    | Is there any relevant information impacted by the threat? If “Yes”, next step 2.9 If “No”, next step 2.10                                                                                                                                                                                                                                                                                                                                                                                                                           | CSIRT       |
| 2.8   | Initiate Information Impact Assessment                                     | Verify the impact of affected information. Next step 2.10                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | CSIRT       |
| 2.9   | Assess Incident Priority                                                   | Re-evaluate the priority of the incident if needed based on the current findings. [Organizations should insert their recommended escalation and priority notification requirements here] Wait on step 2.10                                                                                                                                                                                                                                                                                                                          | CSIRT       |
| 2.10  | Sum Gateway                                                                | Wait until all executed flows are ready, next step Containment                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | CSIRT       |

# Containment

| ID    | Step                                        | Description                                                                                                                                                                                                                                                                                                                                            | Responsible |
|-------|---------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 3.1   | Define How to Prevent Further Compromises   | Evaluate the mitigation actions that should prevent new infections (further occurrences/activity of the threat.) Next step 3.2                                                                                                                                                                                                                         | CSIRT       |
| 3.2   | Parallel Gateway                            | Select all of the following steps: 3.2.1 – 3.2.8 that apply to the technology and incident                                                                                                                                                                                                                                                             | CSIRT       |
| 3.2.1 | Restrict Network Connectivity               | Depending on the mission criticality of the impacted host, consider isolating the host completely until containment is complete.  If isolating is not possible, consider restricting network access to and from external entities to only those IP addresses and domains which are verified and associated with legitimate activity.  Wait on step 3.3 | CSIRT       |
| 3.2.2 | Identify and Terminate Suspicious Processes |  Identify any suspicious processes that might be related to the managed file transfer exploit. Use tools like Task Manager, Process Explorer, or PowerShell commands to view running processes and terminate those that appear malicious or unauthorized.                                                                                              | CSIRT       |
| 3.2.3 | Filter Network Traffic                      | Filter all network traffic related to any discovered network IOCs  Consider the following: Traffic filtering based on application Traffic filtering based on user identity Traffic filtering based on protocol Traffic filtering based on subnets Wait on step 3.3                                                                                     | CSIRT       |
| 3.2.4 | Rotate Credentials and Access Keys          | Reset all credentials, passwords, and access keys associated with the managed file transfer application. This includes administrative accounts, service accounts, and API keys. Use strong, unique passwords and implement multi-factor authentication wherever possible. Wait on step 3.3                                                             | CSIRT       |
| 3.2.5 | Remove Malicious Files                      | Remove any malicious files such as web shells, scripts, post-exploitation tools from the impacted host. Consider implemented hash bans and developing YARA signatures for all file-based IOCs Wait on step 3.3                                                                                                                                         | CSIRT       |
| 3.2.6 | Update AV Signatures                        | Submit sample to AV vendor to get new signatures. Wait on step 3.3                                                                                                                                                                                                                                                                                     | CSIRT       |
| 3.2.7 | 4. Apply Security Patches and Updates       | Ensure that the managed file transfer application and all related software are up to date with the latest security patches and updates. This helps to address known vulnerabilities that could be exploited. Wait on step 3.3                                                                                                                          | CSIRT       |
| 3.2.8 | Harden Configurations                       | Harden the configurations (if relevant). Apply policy changes, or configuration changes, in order to apply the mitigations actions identified. Consider: Disabling services Block script (Powershell, Python etc.) execution  Restrict access to trusted sources To be defined Wait on step 3.3                                                        | CSIRT       |
| 3.2.9 | [Apply Other Containments]                  | [Organizations should implement any other containment policy and procedures here]                                                                                                                                                                                                                                                                      |             |
| 3.3   | Sum Gateway                                 | Wait until all executed flows are ready, next step 3.4                                                                                                                                                                                                                                                                                                 | CSIRT       |
| 3.4   | Confirm Containment                         | Evaluate if the executed containment actions have been successful.  Next step 4.1                                                                                                                                                                                                                                                                      | CSIRT       |

# Eradication

| ID    | Step                       | Description                                                                                                                                                                                                                                                                                                                                                    | Responsible |
|-------|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 4.1   | Parallel Gateway           | Select any of the following steps: 4.1.1 or 4.1.2                                                                                                                                                                                                                                                                                                              | CSIRT       |
| 4.1.1 | Look For Data Exfiltration | Analyse artefacts which could indicate data exfiltration.  Check at least the following:  Network connections from the victim system(s) to external IPs. Are target IPs and the volume of traffic normal? Traces of execution of archiving tools Signs of abnormal usage of protocols (exfiltration over DNS, etc.) Signs of scheduled transfers Next step 4.2 | CSIRT       |
| 4.2   | Data Leakage?              | Is there any indication that data might have been exfiltrated from the victim system(s)? If “Yes”, next step 4.3 If “No”, next step 4.7                                                                                                                                                                                                                        | CSIRT       |
| 4.3   | Data Leakage Investigation | Initiate data leakage investigation.  Identify What type of data has been potentially exfiltrated? What is the security classification of the data? When the exfiltration may have occurred? Does the potential data exfiltration require notifications to employees, customers, service partners or regulatory organisations? Next step 4.5                   | CSIRT       |
| 4.4   | [Additional Playbooks]     | [Organizations should insert any additional eradication processes and procedures here]                                                                                                                                                                                                                                                                         |             |
| 4.5   | Sum Gateway                | Wait until all executed flows are ready, next step 5.1                                                                                                                                                                                                                                                                                                         | CSIRT       |

# Recovery

| ID    | Step                                   | Description                                                                                                                                                                                                                                                   | Responsible |
|-------|----------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 5.1   | Parallel Gateway                       | Select any of the following steps: 5.1.1 or 5.1.2                                                                                                                                                                                                             | CSIRT       |
| 5.1.1 | Monitor Malicious Activity             | Based on the collected IOC information, monitor indicators of malicious activity.  Ensure: Malicious files have been removed Malicious processes have been terminated Compromised users have been reset or removed IP/Domains have been blocked Next step 6.8 | CSIRT       |
| 5.2   | Verify Protection                      | Evaluate if the implemented improvements are enough.  Next step 5.5                                                                                                                                                                                           | CSIRT       |
| 5.3   | Remove Temporary Containment Solutions | Remove any temporary containment solutions that were implemented on the previous steps and to return to normal operations.  Evaluate if any of following is still needed: Increased monitoring Traffic filtering Host isolation To be defined Next step 6.1   | CSIRT       |

# Lessons Learned

| ID    | Step                              | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Responsible |
|-------|-----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| 6.1   | Parallel Gateway                  | Select any of the following steps: 6.1.1 or 6.1.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | CSIRT       |
| 6.1.1 | Lessons Learned Report?           | Evaluate if the incident response process needs to be evaluated.  The lessons learned analysis is needed if There was no playbook for the incident Incident was \<P2\> or higher Lesson learned report is requested by \<CISO\> If “Yes”, next step 6.2 If “No”, wait on step 6.4                                                                                                                                                                                                                                                                                                                                              | CSIRT       |
| 6.1.2 | Root Cause Analysis?              | Evaluate if the root cause analysis is needed.  The root cause analysis is needed if Incident was \<P2\> or higher Investigation  Lesson learned report is requested by \<CISO\> If “Yes”, next step 6.3 If “No”, wait on step 6.4                                                                                                                                                                                                                                                                                                                                                                                             | CSIRT       |
| 6.2   | Create Lessons Learned Report     | Analyse the effectiveness of incident response process.  The report is used to determine how the incident response process can be improved in the future. Analyse incident response ticket / notes to determine what actions were taken throughout the cyber incident response process; if the actions were successful or unsuccessful;  who were involved in the process; and how the time needed for the actions can be shortened in the future.  The report is delivered to  \<list of receivers\>. Report template: \<link to report template\> Report location: \<link to location where reports are stored\> Wait on 6.4 | CSIRT       |
| 6.3   | Create Root Cause Analysis Report | Perform a root cause analysis in order to identify what the root cause of the incident was so that it can be removed. Analyse incident response ticket / notes to and interview the relevant stakeholders to assess infection vector incident impact implemented remediation actions how likelihood of new incident can be decreased. The report is delivered to  \<list of receivers\>. Report template: \<link to report template\> Report location: \<link to location where reports are stored\> Wait on step 6.4                                                                                                          | CSIRT       |
| 6.4   | Sum Gateway                       | Wait until all executed flows are ready, next step 6.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | CSIRT       |
| 6.5   | Update Playbooks?                 | Evaluate if a new playbook is needed OR does the current runbook require updates. If “Yes”, next step 6.6 If “No”, next step                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | CSIRT       |
| 6.6   | Update Playbooks                  | Create a new playbook or update existing one.  Next step 6.7                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | CSIRT       |
| 6.7   | Resolve The Incident              | Resolve the incident with proper resolution code.  Next step 6.8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | CSIRT       |
| 6.8   | Sum Gateway                       | Wait until all executed flows are ready, next step End.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | CSIRT       |
| End   | N/A                               | End of the process.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |             |
